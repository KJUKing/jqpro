<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/public.css">
    <script src="../js/jquery-3.7.1.js"></script> <!-- 외부스크립트 -->
    <!-- <script src="https://code.jquery.com/jquery-3.7.1.js"></script> -->

    <script>

        const xhr = new XMLHttpRequest();
        console.log(xhr);

        $(() => {

            const getData = (url) => {

                return new Promise((resolve, reject) => {

                    const xhr = new XMLHttpRequest();

                    xhr.open('get', url, true);
                    xhr.send();

                    xhr.onload = () => {
                        return resolve(xhr.responseText); //then()함수의 콜백에서 text를 받는다
                    }
                    xhr.onerror = () => {
                        return reject(new Error("오류 발생"))
                    }
                })
            }

            $('#text').on('click', () => {
                getData('text.jsp')
                    .then((res) => {
                        arr = res.split("/");

                        let code = "<ul>";
                        $.each(arr, function (i, v) {
                            code += `<li>${v}</li>`;
                        })
                        code += "</ul>";
                        $('#result1').html(code);
                    })


            })

            $('#jarr').on('click', () => {
                getData('jarr.jsp')
                    .then((res) => JSON.parse(res))
                    .then(data => {
                        let code = "<ol>";
                        $.each(data, function (i, v) {
                            // code += `<li>${data[i]}</li>`
                            code += `<li>${v}</li>`
                            // code += `<li>${this}</li>`
                        })
                        code += "</ol>";
                        $('#result2').html(code);
                    })


            })


            $('#jobj').on('click', () => {

                //요청
                promi = getData('jobj.jsp')
                promi.then((res) => {
                    return JSON.parse(res) //얘가 밑에 data에담김
                })
                    .then((data) => {
                        //data로 출력
                        //출력모양

                        code = "<table border='1'>";

                        code += "<tr><td>이름</td>";
                        code += "<td>" + data.name + "</td></tr>";

                        code += "<tr><td>주소</td>";
                        code += "<td>" + data.addr + "</td></tr>";

                        code += "<tr><td>전화번호</td>";
                        code += "<td>" + data.tel + "</td></tr>";

                        code += "</table>";

                        $('#result3').html(code);
                    })

            })
            $('#jmix').on('click', () => {

                //요청
                // promi = getData('jmix.jsp')
                // promi.then((res) => {
                //     return JSON.parse(res);
                // })
                // .then((data) => {

                // })

                getData('jmix.jsp')
                    .then(res => JSON.parse(res))
                    .then(data => {
                        // for(let user of data){
                        // }
                        let code = "";
                        for (let { name, addr, tel } of data) {
                            code += `<p>이름 : ${name} </p>
                                     <p>주소 : ${addr} </p>
                                     <p>전화번호 : ${tel} </p>
                                     <hr color='blue'>`;
                        }
                        $('#result4').html(code);

                    })
                    .catch(err => console.log(err));
            })
        })

    </script>


    <style>
        #res {
            display: flex;
            flex-direction: row;

        }

        .item {
            flex: 25%;
            margin: 3px;
            padding: 2px;

        }
    </style>
</head>

<body>
    <div class="box">
        <h3>1. 동기적 실행 - 한번에 하나씩 차례대로 순서대로 실행
        </h3>
        <input type="button" value="text" id="text">
        <input type="button" value="jsonarr" id="jarr">
        <input type="button" value="jsonobj" id="jobj">
        <input type="button" value="jsonmix" id="jmix">

        <br>
        <div id="res">
            <div class="item" id="result1"></div>
            <div class="item" id="result2"></div>
            <div class="item" id="result3"></div>
            <div class="item" id="result4"></div>
        </div>
    </div>
</body>

</html>