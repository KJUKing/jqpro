<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/public.css">
    <script src="../js/jquery-3.7.1.js"></script> <!-- 외부스크립트 -->

    <script>
        const getData = (url, vdata) => {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();

                xhr.open('POST', url, true);
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                xhr.send(vdata);

                xhr.onload = () => {
                    if (xhr.status === 200) {
                        resolve(xhr.responseText); // 응답이 성공적으로 도착한 경우
                    } else {
                        reject(new Error("오류 발생: " + xhr.statusText)); // 응답이 실패한 경우
                    }
                };
                xhr.onerror = () => {
                    reject(new Error("네트워크 오류 발생")); // 네트워크 오류 처리
                };
            });
        };

        $(document).ready(() => { // DOM이 준비되면 이벤트 리스너를 설정합니다.
            $('#btn1').on('click', () => {
                let vname = $('#name').val().trim();
                let vid = $('#id').val().trim();

                let params = "name=" + vname + "&id=" + vid;

                // //text/html html코드로 응답받았을때
                // getData('postTEst.jsp', params)
                //     .then(res => {
                //         $('#result1').html(res)
                //     })

                //응답데이터를 html코드(text)로 응답받아서 객체를 parsing해야함
                getData('postTest.jsp', params)
                    .then(res => {
                        return JSON.parse(res); // 서버에서 받은 JSON 응답을 파싱합니다.
                    })
                    .then(data => {
                        let code = `<p>이름 : ${data.name}</p>`;
                        code += `<p>아이디 : ${data.id}</p>`;
                        $('#result1').html(code); // 결과를 HTML에 표시합니다.
                    })
                    .catch(err => {
                        console.error(err); // 오류 발생 시 콘솔에 출력합니다.
                    });
            });
        });
    </script>

    <style>
        #res {
            display: flex;
            flex-direction: row;
        }

        .item {
            flex: 25%;
            margin: 3px;
            padding: 2px;
        }
    </style>
</head>

<body>
    <div class="box">
        <h3>1. 동기적 실행 - 한번에 하나씩 차례대로 순서대로 실행</h3>

        <form name="ff">
            이름<input type="text" name="name" id="name"><br>
            아이디<input type="text" name="id" id="id"> <br>
            <input type="button" value="확인" id="btn1">
        </form>

        <div id="res">
            <div class="item" id="result1"></div>
        </div>
    </div>
</body>

</html>
