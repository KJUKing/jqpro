<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/public.css">
    <script src="../js/jquery-3.7.1.js"></script> <!-- 외부스크립트 -->
    <!-- <script src="https://code.jquery.com/jquery-3.7.1.js"></script> -->

    <script>

        const xhr = new XMLHttpRequest();
        console.log(xhr);

        $(() => {

            const getData = (url) => {

                return new Promise((resolve, reject) => {

                    const xhr = new XMLHttpRequest();

                    xhr.open('get', url, true);
                    xhr.send();

                    xhr.onload = () => {
                        return resolve(xhr.responseText); //then()함수의 콜백에서 text를 받는다
                    }
                    xhr.onerror = () => {
                        return reject(new Error("오류 발생"))
                    }
                })
            }


            $('#jobj').on('click', () => {

                //요청
                promi = getData('jobj.jsp')
                promi.then((res) => {
                    return JSON.parse(res) //얘가 밑에 data에담김
                })
                    .then((data) => {
                        //data로 출력
                        //출력모양

                        code = "<table border='1'>";

                        code += "<tr><td>이름</td>";
                        code += "<td>" + data.name + "</td></tr>";

                        code += "<tr><td>주소</td>";
                        code += "<td>" + data.addr + "</td></tr>";

                        code += "<tr><td>전화번호</td>";
                        code += "<td>" + data.tel + "</td></tr>";

                        code += "</table>";

                        $('#result3').html(code);
                    })

            })
            $('#jmix').on('click', () => {

                //요청
                xhr.open('get', 'jmix.jsp', true);
                xhr.send();
                //응답
                xhr.onload = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        res = this.responseText;

                        jres = JSON.parse(res);
                        //출력모양

                        code = "";
                        for ({ name, addr, tel } of jres) {

                            code += `<p>이름 : ${name} </p>
                                     <p>주소 : ${addr} </p>
                                     <p>전화번호 : ${tel} </p>
                                     <hr color='blue'>`;
                        }
                        //출력    
                        $('#result4').html(code);


                    }
                }
            })
        })

    </script>


    <style>
        #res {
            display: flex;
            flex-direction: row;

        }

        .item {
            flex: 25%;
            margin: 3px;
            padding: 2px;

        }
    </style>
</head>

<body>
    <div class="box">
        <h3>1. 동기적 실행 - 한번에 하나씩 차례대로 순서대로 실행
        </h3>
        <input type="button" value="text" id="text">
        <input type="button" value="jsonarr" id="jarr">
        <input type="button" value="jsonobj" id="jobj">
        <input type="button" value="jsonmix" id="jmix">

        <br>
        <div id="res">
            <div class="item" id="result1"></div>
            <div class="item" id="result2"></div>
            <div class="item" id="result3"></div>
            <div class="item" id="result4"></div>
        </div>
    </div>
</body>

</html>